# Hooks è¯´æ˜

æœ¬é¡¹ç›®ä½¿ç”¨ Claude Code çš„ Hooks ç³»ç»Ÿå®ç°è‡ªåŠ¨åŒ–å·¥ä½œæµï¼ŒåŒ…æ‹¬ç”¨æˆ·ç”»åƒæ£€æŸ¥ã€æŠ€èƒ½å˜æ›´è¿½è¸ªã€çŠ¶æ€æ›´æ–°ã€æ„å›¾è·¯ç”±ã€é€šçŸ¥æé†’ç­‰åŠŸèƒ½ã€‚

## ç›®å½•

```
.claude/hooks/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ common.sh            # å…±äº«å‡½æ•°åº“
â”œâ”€â”€ intent-detect.sh         # æ„å›¾è·¯ç”±è§„åˆ™æ³¨å…¥
â”œâ”€â”€ session-start.sh         # ä¼šè¯å¯åŠ¨æ—¶çš„æ£€æŸ¥
â”œâ”€â”€ track-skills-change.sh   # æŠ€èƒ½æ–‡ä»¶å˜æ›´è¿½è¸ª
â”œâ”€â”€ update-status.sh         # ç³»ç»ŸçŠ¶æ€æ›´æ–°
â”œâ”€â”€ promote-to-proven.sh     # æŠ€èƒ½å‡çº§è„šæœ¬
â”œâ”€â”€ task-complete.sh         # ä»»åŠ¡å®Œæˆæç¤º
â”œâ”€â”€ response-complete.sh     # å¯¹è¯å®Œæˆæç¤º
â”œâ”€â”€ notify-server.py         # æµè§ˆå™¨é€šçŸ¥æœåŠ¡å™¨
â””â”€â”€ start-notify-server.sh   # å¯åŠ¨é€šçŸ¥æœåŠ¡å™¨
```

## é…ç½®æ–‡ä»¶

Hooks åœ¨ `.claude/settings.json` ä¸­é…ç½®ï¼š

```json
{
  "hooks": {
    "UserPromptSubmit": [
      { "command": ".../intent-detect.sh" },
      { "command": ".../update-status.sh" }
    ],
    "SessionStart": [
      { "command": ".../session-start.sh" },
      { "command": ".../update-status.sh" }
    ],
    "PostToolUse": [
      { "matcher": "Write|Edit", "command": ".../track-skills-change.sh" },
      { "matcher": "Write|Edit", "command": ".../update-status.sh" },
      { "matcher": "TaskCreate|TaskUpdate", "command": ".../update-status.sh" }
    ],
    "Stop": [
      { "command": ".../response-complete.sh" },
      { "command": ".../task-complete.sh" }
    ]
  }
}
```

## Hook è¯¦è§£

### 0. lib/common.sh

**ç±»å‹**: å…±äº«å‡½æ•°åº“ï¼ˆä¸æ˜¯ç‹¬ç«‹ Hookï¼‰

**åŠŸèƒ½**: æä¾›é¡¹ç›®åˆå§‹åŒ–ã€é¢œè‰²è¾“å‡ºã€JSON æ“ä½œã€æŠ€èƒ½ç±»å‹åˆ¤æ–­ç­‰é€šç”¨åŠŸèƒ½

**ä¸»è¦å‡½æ•°**:
| å‡½æ•° | è¯´æ˜ |
|------|------|
| `project_dir_init()` | åˆå§‹åŒ–é¡¹ç›®è·¯å¾„å˜é‡ |
| `init_colors()` | åˆå§‹åŒ– ANSI é¢œè‰²å˜é‡ |
| `check_jq()` | æ£€æŸ¥ jq æ˜¯å¦å®‰è£… |
| `atomic_json_update()` | åŸå­æ€§æ›´æ–° JSON æ–‡ä»¶ |
| `json_read()` | å®‰å…¨è¯»å– JSON å€¼ |
| `get_skill_type()` | åˆ¤æ–­æŠ€èƒ½ç±»å‹ (user/task/proven/builtin) |
| `get_skill_count()` | è·å–æŒ‡å®šç±»å‹æŠ€èƒ½æ•°é‡ |
| `check_skill_limit()` | æ£€æŸ¥æŠ€èƒ½æ•°é‡æ˜¯å¦è¶…é™ |
| `increment_p_skill_usage()` | å¢åŠ  p_ æŠ€èƒ½ä½¿ç”¨æ¬¡æ•° |
| `log_changelog()` | è®°å½•å˜æ›´åˆ° changelog |

**æŠ€èƒ½ç±»å‹è¯†åˆ«**:
| æ¨¡å¼ | ç±»å‹ | ç¤ºä¾‹ |
|------|------|------|
| `^u_[a-z_]+$` | user | `u_react_hooks` |
| `^k[0-9]+_[a-z_]+$` | task | `k01_init_project` |
| `^p_[a-z_]+$` | proven | `p_mdx_setup` |
| å…¶ä»– | builtin | `user-profile` |

---

### 1. intent-detect.sh

**è§¦å‘æ—¶æœº**: æ¯æ¬¡ UserPromptSubmitï¼ˆç”¨æˆ·æäº¤è¾“å…¥æ—¶ï¼‰

**åŠŸèƒ½**:
- å°† `.info/info.md` æ„å›¾è·¯ç”±è§„åˆ™æ³¨å…¥åˆ°ä¸Šä¸‹æ–‡
- åœ¨ç”¨æˆ·è¾“å…¥ä¸‹æ–¹æ˜¾ç¤ºå½“å‰è¾“å…¥æ‘˜è¦
- ç”¨äºæ„å›¾è¯†åˆ«å’Œå‘½ä»¤åˆ†å‘

**è¾“å‡ºç¤ºä¾‹**:
```
# æ„å›¾è·¯ç”±è§„åˆ™å†…å®¹...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“ å½“å‰è¾“å…¥: è¯·å¸®æˆ‘åˆ†æ Hooks
   è¯·å‚è€ƒä¸Šè¿°è§„åˆ™è¿›è¡Œæ„å›¾è¯†åˆ«å’Œåˆ†å‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

**ç›¸å…³æ–‡ä»¶**: `.info/info.md`ï¼ˆæ„å›¾è·¯ç”±è§„åˆ™æ–‡ä»¶ï¼‰

---

### 2. session-start.sh

**è§¦å‘æ—¶æœº**: æ¯æ¬¡ Claude Code ä¼šè¯å¯åŠ¨æ—¶

**åŠŸèƒ½**:
- æ£€æŸ¥ç”¨æˆ·ç”»åƒæ˜¯å¦å­˜åœ¨ (`.info/usr.json`)
- æ£€æŸ¥ `info/` ç›®å½•æ˜¯å¦æœ‰æ–°æ–‡ä»¶
- æ¯”è¾ƒæ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œåˆ¤æ–­ç”»åƒæ˜¯å¦éœ€è¦æ›´æ–°
- æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å’Œå½“å‰æŒæ¡çš„æŠ€èƒ½æ•°é‡

**è¾“å‡ºç¤ºä¾‹**:
```
âœ… ç”¨æˆ·ç”»åƒå·²åŠ è½½: QY (å…¨æ ˆå¼€å‘è€…)
   å½“å‰æŒæ¡ 3 ä¸ªç”¨æˆ·æŠ€èƒ½
```

**ä¾èµ–**: `lib/common.sh`ã€`jq`

---

### 3. track-skills-change.sh

**è§¦å‘æ—¶æœº**: ä½¿ç”¨ `Write` æˆ– `Edit` å·¥å…·ä¿®æ”¹ `.claude/skills/` ç›®å½•ä¸­çš„æ–‡ä»¶æ—¶

**åŠŸèƒ½**:
- è¿½è¸ªæŠ€èƒ½æ–‡ä»¶çš„åˆ›å»ºå’Œä¿®æ”¹
- è‡ªåŠ¨å°†æ–°æŠ€èƒ½æ³¨å†Œåˆ° `tasks.json`
- è®°å½•æŠ€èƒ½å˜æ›´åˆ° `.info/skills_changelog.jsonl`

**è‡ªåŠ¨åŒ–è¡Œä¸º**:
- åˆ›å»º `u_` æŠ€èƒ½ â†’ è‡ªåŠ¨æ·»åŠ åˆ° `tasks.json.user_skills`
- åˆ›å»º `k_` æŠ€èƒ½ â†’ è‡ªåŠ¨å…³è”åˆ°å¯¹åº”ä»»åŠ¡å¹¶æ·»åŠ åˆ° `steps` åˆ—è¡¨
- åˆ›å»º `p_` æŠ€èƒ½ â†’ è‡ªåŠ¨æ·»åŠ åˆ° `tasks.json.proven_skills`
- ç¼–è¾‘ `p_` æŠ€èƒ½ â†’ è‡ªåŠ¨å¢åŠ  `usage_count`

**æŠ€èƒ½æ•°é‡é™åˆ¶**:
- `u_` æŠ€èƒ½: æœ€å¤š 5 ä¸ª
- `p_` æŠ€èƒ½: æœ€å¤š 10 ä¸ª

---

### 4. update-status.sh

**è§¦å‘æ—¶æœº**:
- SessionStart
- Write/Edit å·¥å…·ä½¿ç”¨å
- TaskCreate/TaskUpdate å·¥å…·ä½¿ç”¨å

**åŠŸèƒ½**:
- èšåˆç³»ç»ŸçŠ¶æ€ä¿¡æ¯
- å†™å…¥ `.info/.status.json` ä¾› statusline ä½¿ç”¨

**çŠ¶æ€æ–‡ä»¶ç»“æ„**:
```json
{
  "active_task": "k01",
  "task_name": "æ­å»º Next.js åšå®¢",
  "total_steps": 5,
  "completed_steps": 2,
  "total_tasks": 3,
  "active_tasks": 1,
  "completed_tasks": 1,
  "user_name": "QY",
  "user_role": "å…¨æ ˆå¼€å‘è€…",
  "skills_count": 3,
  "profile_fresh": true,
  "proven_skills_count": 2,
  "top_reused_skill": "p_mdx_setup",
  "top_reuse_count": 5,
  "total_reuses": 12,
  "active_proven_skills": 2,
  "updated_at": "2026-01-28T10:30:00Z"
}
```

---

### 5. promote-to-proven.sh

**ç±»å‹**: æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬ï¼ˆéè‡ªåŠ¨ Hookï¼‰

**åŠŸèƒ½**:
- å°†å·²éªŒè¯çš„ `k_` æŠ€èƒ½å‡çº§ä¸º `p_` (proven) æŠ€èƒ½
- è‡ªåŠ¨å½’æ¡£åŸå§‹ `k_` æŠ€èƒ½åˆ° `.claude/skills/.archived/`
- æ›´æ–° `tasks.json.proven_skills` å…ƒæ•°æ®

**ç”¨æ³•**:
```bash
bash .claude/hooks/promote-to-proven.sh <k_skill_name> <p_skill_name> [description]
```

**ç¤ºä¾‹**:
```bash
# å°† k01_config_mdx å‡çº§ä¸º p_mdx_setup
bash .claude/hooks/promote-to-proven.sh k01_config_mdx p_mdx_setup "MDX é…ç½®æŠ€èƒ½"
```

**éªŒè¯**:
- æ£€æŸ¥ `k_` æŠ€èƒ½æ˜¯å¦å­˜åœ¨
- æ£€æŸ¥ `p_` æŠ€èƒ½å‘½åæ ¼å¼ (`^p_[a-z_]+$`)
- æ£€æŸ¥ `p_` æŠ€èƒ½æ•°é‡ä¸Šé™ (10 ä¸ª)

---

### 6. task-complete.sh

**è§¦å‘æ—¶æœº**: Stop Hookï¼ˆä¼šè¯ç»“æŸæ—¶ï¼‰

**åŠŸèƒ½**:
- æ’­æ”¾ä»»åŠ¡å®Œæˆæç¤ºéŸ³ï¼ˆä½¿ç”¨ aplay æˆ– beepï¼‰
- æ˜¾ç¤ºé†’ç›®çš„ç»ˆç«¯è§†è§‰æç¤º
- é€‚ç”¨äºæ— å›¾å½¢ç•Œé¢çš„ç¯å¢ƒ

**å£°éŸ³æ¥æº**:
1. ç³»ç»Ÿå£°éŸ³æ–‡ä»¶ï¼ˆä¼˜å…ˆï¼‰:
   - `/usr/share/sounds/freedesktop/stereo/complete.oga`
   - `/usr/share/sounds/freedesktop/stereo/success.oga`
2. beep å‘½ä»¤ï¼ˆå¤‡é€‰ï¼‰
3. ç»ˆç«¯å“é“ƒ (`\a`)

---

### 7. response-complete.sh

**è§¦å‘æ—¶æœº**: Stop Hookï¼ˆä¼šè¯ç»“æŸæ—¶ï¼‰

**åŠŸèƒ½**:
- ä¿®æ”¹ç»ˆç«¯æ ‡é¢˜æ˜¾ç¤º "âœ“ Claude å“åº”å®Œæˆ"
- æ˜¾ç¤ºå¢å¼ºçš„è§†è§‰æç¤ºï¼ˆé—ªçƒè¾¹æ¡†ã€å·¨å¤§é†’ç›®æ¶ˆæ¯ï¼‰
- å†™å…¥å®ŒæˆçŠ¶æ€åˆ° `.info/.last_complete`
- è§¦å‘æµè§ˆå™¨é€šçŸ¥ï¼ˆé€šè¿‡ notify-server.pyï¼‰

**è§†è§‰æ•ˆæœ**:
```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

   âœ“  CLAUDE å“åº”å®Œæˆ  14:30:25

â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”€â”€â”€ æŒ‰ Ctrl+L æ¸…å± / è¾“å…¥ç»§ç»­å¯¹è¯ â”€â”€â”€
```

---

### 8. notify-server.py

**ç±»å‹**: Python HTTP æœåŠ¡å™¨ï¼ˆéœ€æ‰‹åŠ¨å¯åŠ¨ï¼‰

**åŠŸèƒ½**:
- æä¾› Web ç•Œé¢å±•ç¤º Claude å®Œæˆé€šçŸ¥
- æ”¯æŒæµè§ˆå™¨åŸç”Ÿé€šçŸ¥ï¼ˆNotification APIï¼‰
- è½®è¯¢æ£€æŸ¥ `.info/.last_complete` æ–‡ä»¶

**å¯åŠ¨æ–¹å¼**:
```bash
bash .claude/hooks/start-notify-server.sh
```

**è®¿é—®åœ°å€**: `http://localhost:8888/notify`

**API ç«¯ç‚¹**:
| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| `/` æˆ– `/notify` | é€šçŸ¥é¡µé¢ |
| `/api/notify-check` | è¿”å›æœ€æ–°é€šçŸ¥æ—¶é—´æˆ³ |

**Codespace ä½¿ç”¨**:
1. ç‚¹å‡» "Ports" æ ‡ç­¾
2. æ‰¾åˆ°ç«¯å£ 8888 å¹¶ç‚¹å‡» "Forward"
3. æ‰“å¼€æµè§ˆå™¨è®¿é—®è½¬å‘åçš„åœ°å€

---

### 9. start-notify-server.sh

**ç±»å‹**: è¾…åŠ©å¯åŠ¨è„šæœ¬

**åŠŸèƒ½**:
- è‡ªåŠ¨æ£€æµ‹ Python ç‰ˆæœ¬å¹¶å¯åŠ¨ notify-server.py
- æ”¯æŒ `python3` å’Œ `python` å‘½ä»¤

---

## Hook æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Code ä¼šè¯å¯åŠ¨                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ session-start   â”‚
                    â”‚  - æ£€æŸ¥ç”»åƒ     â”‚
                    â”‚  - æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ update-status   â”‚
                    â”‚  - æ›´æ–°çŠ¶æ€æ–‡ä»¶ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æäº¤è¾“å…¥                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ intent-detect â”‚         â”‚ update-status â”‚
        â”‚  - æ³¨å…¥è§„åˆ™   â”‚         â”‚  - æ›´æ–°çŠ¶æ€   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å·¥å…·ä½¿ç”¨ (Write/Edit)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ track-skills  â”‚         â”‚ update-status â”‚
        â”‚  - æ³¨å†ŒæŠ€èƒ½   â”‚         â”‚  - æ›´æ–°çŠ¶æ€   â”‚
        â”‚  - è®°å½•å˜æ›´   â”‚         â”‚  - æ›´æ–°çŠ¶æ€   â”‚
        â”‚  - æ£€æŸ¥é™åˆ¶   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼šè¯ç»“æŸ (Stop)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚response-compl â”‚         â”‚ task-complete â”‚
        â”‚  - è§†è§‰æç¤º   â”‚         â”‚  - æ’­æ”¾å£°éŸ³   â”‚
        â”‚  - ä¿®æ”¹æ ‡é¢˜   â”‚         â”‚  - æ˜¾ç¤ºæç¤º   â”‚
        â”‚  - è§¦å‘é€šçŸ¥   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ notify-server â”‚ (éœ€æ‰‹åŠ¨å¯åŠ¨)
        â”‚  - Web é€šçŸ¥   â”‚
        â”‚  - æµè§ˆå™¨é€šçŸ¥ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¾èµ–è¦æ±‚

æ‰€æœ‰ hooks ä¾èµ–ä»¥ä¸‹å·¥å…·ï¼š

| å·¥å…· | ç”¨é€” | å®‰è£…å‘½ä»¤ | å¿…éœ€ |
|------|------|----------|------|
| `jq` | JSON å¤„ç† | `brew install jq` / `apt install jq` | æ˜¯ |
| `bash` | Shell æ‰§è¡Œ | ç³»ç»Ÿè‡ªå¸¦ | æ˜¯ |
| `python3` | é€šçŸ¥æœåŠ¡å™¨ | ç³»ç»Ÿè‡ªå¸¦ / `apt install python3` | å¯é€‰ |
| `aplay` | å£°éŸ³æ’­æ”¾ | `apt install alsa-utils` | å¯é€‰ |
| `beep` | èœ‚é¸£éŸ³ | `apt install beep` | å¯é€‰ |

## æŠ€èƒ½å‘½åè§„èŒƒ

| å‰ç¼€ | ç±»å‹ | ç”¨é€” | æ•°é‡é™åˆ¶ |
|------|------|------|----------|
| `u_` | User Skill | ç”¨æˆ·å­¦åˆ°çš„æŠ€èƒ½ | 5 ä¸ª |
| `k[0-9]+_` | Task Skill | ä»»åŠ¡å­æŠ€èƒ½ï¼ˆç”± skill-generator ç”Ÿæˆï¼‰ | æ— é™åˆ¶ |
| `p_` | Proven Skill | éªŒè¯é€šè¿‡çš„æŠ€èƒ½ï¼ˆå¯å¤ç”¨ï¼‰ | 10 ä¸ª |
| æ— å‰ç¼€ | Built-in Skill | ç³»ç»Ÿå†…ç½®æŠ€èƒ½ | æ— é™åˆ¶ |

## æŠ€èƒ½ç”Ÿå‘½å‘¨æœŸ

```
åˆ›å»ºä»»åŠ¡ (commander)
    â”‚
    â–¼
ç”Ÿæˆ k_ æŠ€èƒ½ (skill-generator)
    â”‚
    â–¼
æ‰§è¡Œå¹¶éªŒè¯
    â”‚
    â–¼
å‡çº§ä¸º p_ æŠ€èƒ½ (promote-to-proven.sh)
    â”‚
    â”œâ”€â–º å¤ç”¨ p_ æŠ€èƒ½åˆ°æ–°ä»»åŠ¡
    â”‚       â”‚
    â”‚       â–¼
    â”‚   usage_count +1
    â”‚
    â””â”€â–º å½’æ¡£ä½é¢‘æŠ€èƒ½
```

## æ•…éšœæ’é™¤

### Hook æœªæ‰§è¡Œ

1. æ£€æŸ¥ `.claude/settings.json` ä¸­ hooks é…ç½®æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤è„šæœ¬æ–‡ä»¶å…·æœ‰æ‰§è¡Œæƒé™ (`chmod +x .claude/hooks/*.sh`)
3. æŸ¥çœ‹ Claude Code æ—¥å¿—ç¡®è®¤ hook è°ƒç”¨æƒ…å†µ

### çŠ¶æ€æœªæ›´æ–°

1. ç¡®è®¤ `jq` å·²å®‰è£…
2. æ£€æŸ¥ `.info/.status.json` æ–‡ä»¶æƒé™
3. æ‰‹åŠ¨è¿è¡Œ hook æµ‹è¯•: `bash .claude/hooks/update-status.sh`

### æŠ€èƒ½æœªè‡ªåŠ¨æ³¨å†Œ

1. ç¡®è®¤æŠ€èƒ½ç›®å½•å‘½åç¬¦åˆè§„èŒƒ (`k01_xxx`ã€`u_xxx` æˆ– `p_xxx`)
2. æ£€æŸ¥ `.info/tasks.json` æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹ `.info/skills_changelog.jsonl` è·å–è¯¦ç»†æ—¥å¿—
4. æ£€æŸ¥æŠ€èƒ½æ•°é‡æ˜¯å¦å·²è¾¾ä¸Šé™

### æŠ€èƒ½å‡çº§å¤±è´¥ (promote-to-proven.sh)

1. ç¡®è®¤åŸå§‹ `k_` æŠ€èƒ½å­˜åœ¨
2. ç¡®è®¤ `p_` æŠ€èƒ½å‘½åæ ¼å¼æ­£ç¡® (`^p_[a-z_]+$`)
3. æ£€æŸ¥ `p_` æŠ€èƒ½æ•°é‡æ˜¯å¦å·²è¾¾ä¸Šé™ (10 ä¸ª)
4. ç¡®è®¤ `jq` å·²å®‰è£…

### é€šçŸ¥ä¸å·¥ä½œ

1. ç¡®è®¤ notify-server.py å·²å¯åŠ¨: `bash .claude/hooks/start-notify-server.sh`
2. æ£€æŸ¥ç«¯å£ 8888 æ˜¯å¦è¢«å ç”¨
3. åœ¨ Codespace ä¸­ç¡®è®¤ç«¯å£è½¬å‘å·²å¯ç”¨
4. æ£€æŸ¥æµè§ˆå™¨é€šçŸ¥æƒé™æ˜¯å¦å·²æˆäºˆ

### æ„å›¾è·¯ç”±æœªç”Ÿæ•ˆ

1. ç¡®è®¤ `.info/info.md` æ–‡ä»¶å­˜åœ¨
2. æ£€æŸ¥ settings.json ä¸­ `UserPromptSubmit` hook é…ç½®
3. æŸ¥çœ‹ intent-detect.sh çš„è¾“å‡ºï¼ˆä¼šåœ¨ç”¨æˆ·è¾“å…¥ä¸‹æ–¹æ˜¾ç¤ºï¼‰

### æŠ€èƒ½æ•°é‡è¶…é™

1. æŸ¥çœ‹å½“å‰æŠ€èƒ½: `jq '.user_skills' .info/tasks.json`
2. å½’æ¡£ä½é¢‘æŠ€èƒ½: åˆ é™¤ tasks.json ä¸­çš„å¯¹åº”æ¡ç›®
3. æˆ–åˆ é™¤ `.claude/skills/` ä¸‹å¯¹åº”çš„æŠ€èƒ½ç›®å½•
