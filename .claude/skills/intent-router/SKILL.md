---
name: intent-router
description: 统一的用户意图识别与分发中心。自动识别用户输入的意图类型（身份查询、任务请求、问题咨询等），并分发到对应的处理方。这是所有用户请求的统一入口。
---

# 意图路由器

自动识别用户输入的意图类型，并分发到对应的处理方。

## 设计理念

```
用户输入
    ↓
intent-router (统一识别与分发)
    ↓
├── 身份查询 → user-profile
├── 任务请求 → commander
├── 问题咨询 → AI 直接回答
├── 技能命令 → 具体技能
└── 其他请求 → 智能路由
```

**核心优势**：
- ✅ 统一入口：所有意图都在一个地方判断
- ✅ 易于扩展：新增意图只需修改 router
- ✅ 职责清晰：各 skill 专注自己的功能
- ✅ 可调试：完整的意图分发日志

---

## 意图类型识别

### 1. 身份查询 (identity)

**触发模式**：

| 中文 | 英文 |
|-----|------|
| "我是谁" | "Who am I" |
| "我的画像" | "My profile" |
| "我的信息" | "My information" |
| "看看我的资料" | "Show my profile" |

**处理方式**：分发到 `user-profile` skill

**响应流程**：
```
识别为身份查询
    ↓
检查 .info/usr.json 状态
    ↓
┌─────────────────────────────────────────┐
│ 不存在 → 询问是否生成                    │
│ 有新文件 → 询问是否更新                  │
│ 最新 → 显示画像摘要                      │
└─────────────────────────────────────────┘
```

---

### 2. 任务请求 (task)

**触发模式**：

| 中文 | 英文 | 示例 |
|-----|------|------|
| "帮我写..." | "Help me write..." | "帮我写一个AI4S本子" |
| "我要做一个..." | "I want to build..." | "我要做一个博客" |
| "创建一个..." | "Create a..." | "创建一个Next.js项目" |
| "开发..." | "Develop..." | "开发一个API服务" |
| "实现..." | "Implement..." | "实现用户认证功能" |
| "搭建..." | "Build..." | "搭建一个监控系统" |
| "设计..." | "Design..." | "设计一个数据库" |

**判断依据**：
- 包含动作动词（写、做、创建、开发、实现、搭建、设计...）
- 有明确的任务对象
- 不是简单的信息查询

**处理方式**：分发到 `commander` skill

**任务类型判断**：

| 类型 | 关键词 | commander 参数 |
|-----|-------|--------------|
| **开发任务** | 项目、网站、应用、API、服务 | `--type=dev` |
| **文档任务** | 本子、文档、报告、申报书 | `--type=doc` |
| **研究任务** | 研究、分析、调研 | `--type=research` |
| **设计任务** | 设计、架构、方案 | `--type=design` |

---

### 3. 问题咨询 (question)

**触发模式**：

| 中文 | 英文 |
|-----|------|
| "如何..." | "How to..." |
| "怎么..." | "How do I..." |
| "什么是..." | "What is..." |
| "为什么..." | "Why..." |

**判断依据**：
- 疑问词开头
- 询问具体知识或方法
- 不需要执行复杂任务

**处理方式**：AI 直接回答

---

### 4. 技能命令 (command)

**触发模式**：`/skill-name` 格式

**示例**：
- `/user-profile`
- `/commander start`
- `/commander status`

**处理方式**：调用对应 skill

---

### 5. 其他请求 (other)

**不匹配上述模式**的请求

**处理方式**：
- 分析用户意图
- 提供相应帮助或引导

---

## 处理流程

### 主流程

```
接收用户输入
    ↓
步骤 1：优先级检查
    ├─ 是技能命令？ → 调用对应 skill
    └─ 否 → 继续
    ↓
步骤 2：意图匹配
    ├─ 身份查询模式？ → 分发到 user-profile
    ├─ 任务请求模式？ → 分发到 commander
    ├─ 问题咨询模式？ → 直接回答
    └─ 其他 → 智能处理
    ↓
步骤 3：执行分发
    └─ 调用对应的处理方
```

### 优先级规则

```
1. 技能命令 (/xxx)     最高优先级
2. 身份查询            明确意图
3. 任务请求            明确意图
4. 问题咨询            兜底处理
5. 其他请求            智能判断
```

---

## 分发示例

### 示例 1：身份查询

**用户**: 我是谁

**intent-router**:
```
意图类型: identity
分发目标: user-profile
检查画像: 不存在
询问用户: "用户画像不存在，是否立即生成？"
```

---

### 示例 2：任务请求

**用户**: 帮我写一个关于 AI4S 的本子

**intent-router**:
```
意图类型: task
任务类型: doc (文档任务)
分发目标: commander
调用: Skill("commander", "start --type=doc AI4S基金申请书")
```

---

### 示例 3：问题咨询

**用户**: Next.js 怎么配置 MDX？

**intent-router**:
```
意图类型: question
处理方式: 直接回答
```

---

### 示例 4：技能命令

**用户**: /commander status

**intent-router**:
```
意图类型: command
分发目标: commander
调用: Skill("commander", "status")
```

---

## 错误处理

| 场景 | 处理方式 |
|------|---------|
| 意图不明确 | 询问用户具体需求，提供选项 |
| 多重意图匹配 | 按优先级选择，或询问用户 |
| 分发目标不可用 | 提示用户手动调用对应命令 |
| 任务描述模糊 | 引导用户补充细节 |

---

## 与其他 skill 的关系

```
intent-router (顶层路由)
    │
    ├── user-profile (身份查询处理)
    ├── commander (任务管理)
    │   └── skill-generator (技能生成)
    └── k[0-9]*_*/ (具体执行技能)
```

**各 skill 职责**：

| skill | 职责 | 不再负责 |
|-------|------|---------|
| **intent-router** | 意图识别与分发 | 具体任务执行 |
| **user-profile** | 画像生成与显示 | 意图判断 |
| **commander** | 任务管理与分解 | 意图判断 |
| **skill-generator** | 技能生成 | - |

---

## 扩展新意图

添加新意图类型的步骤：

1. **定义触发模式**：在 SKILL.md 中添加触发词
2. **定义处理方式**：指定分发目标或处理逻辑
3. **添加示例**：提供示例对话
4. **更新优先级**：在优先级规则中定位

**示例**：添加"代码审查"意图

```markdown
### 6. 代码审查 (code-review)

触发模式：
- "帮我 review 代码"
- "检查这段代码"

处理方式：分发到 code-review skill
```

---

## 注意事项

1. **保持简洁**：意图判断要快速，不要过度分析
2. **明确优先级**：避免意图冲突时的歧义
3. **兼容手动调用**：不干扰用户直接使用技能命令
4. **记录日志**：便于调试和优化意图识别

---

## 对比：处理方式

| 用户输入 | 旧方式 | 新方式 (intent-router) |
|---------|-------|----------------------|
| "我是谁" | user-profile 直接响应 | router → user-profile |
| "帮我写..." | task-intent → commander | router → commander |
| "/user-profile" | 直接调用 | router → user-profile |
| "如何配置..." | AI 直接回答 | router → 直接回答 |

**统一入口，逻辑清晰！**
